/**
 * Imgur extension for phpBB.
 * @author Alfredo Ramos <alfredo.ramos@yandex.com>
 * @copyright 2017 Alfredo Ramos
 * @license GPL-2.0-only
 */
!function(){"use strict";let e=document.body.querySelector("#imgur-authorize");if(1===parseInt(e.getAttribute("data-ajax-authorized")))return;let t=new FormData,r=location.hash.substring(1),n=/([^&=]+)=([^&]*)/g,s=null,o={},a=[];do{if(!(s=n.exec(r)))break;t.set([decodeURIComponent(s[1])],decodeURIComponent(s[2]))}while(s);if(t.entries().next().done)return;const i=new XMLHttpRequest;i.addEventListener("load",function(e){try{if(4===e.target.readyState&&200===e.target.status)return void(null!==window.opener&&(window.opener.location.reload(!0),window.close()));let r=e.target.responseText;if(r.length<=0)return void a.push(window.imgur.lang.emptyResponse);if(o=JSON.parse(r),Object.keys(o).length<=0)return void a.push(window.imgur.lang.emptyResponse);Array.isArray(o)?o.forEach(function(e){e&&a.push(e.message)}):a.push(o.message)}catch(t){a.push(t.message)}showImgurErrors(a)}),i.addEventListener("error",function(e){try{let r=e.target.responseText;if(r.length<=0)return void a.push(window.imgur.lang.emptyResponse);if(o=JSON.parse(r),Object.keys(o).length<=0)return void a.push(window.imgur.lang.emptyResponse);Array.isArray(o)?o.forEach(function(e){e&&a.push(e.message)}):a.push(o.message)}catch(t){a.push(t.message)}showImgurErrors(a)}),i.addEventListener("loadend",function(){t=new FormData,o={},a=[]}),i.open("POST",e.getAttribute("data-ajax-action").trim(),!0),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.setRequestHeader("Cache-Control","no-cache"),i.send(t)}();
